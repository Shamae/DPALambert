<!DOCTYPE html>
<html>
  <head>
    <title>WORLDMAP PROTO</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.pm@0.17.3/dist/leaflet.pm.css" />
    <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />

   

    <script src="src/SMVlib.js"></script>
    <script src="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.pm@0.17.3/dist/leaflet.pm.min.js"></script>

    <link rel="stylesheet" href="plugins/Leaflet.StyledLayerControl/css/styledLayerControl.css" />
	<script src="plugins/Leaflet.StyledLayerControl/src/styledLayerControl.js"></script>

  <!-- Add font awesome // CDN -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  
  <!-- Add easybutton plugin // CDN -->
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
  <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

  <!-- Add PM geometry plugin // sources-->
  <link rel="stylesheet" href="plugins/Leaflet.PM/leaflet.pm.css" />
  <!--<script src="plugins/Leaflet.PM/leaflet.pm.min.js"></script>-->
  <script src="plugins/Leaflet.PM/leaflet.pm.hacked.js"></script>

  <!-- MODAL -->

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <script>
      var lat = 0;
      var lng = 0;
      var map;
      var layer;
      function init() {
        var mapMinZoom = 0;
        var mapMaxZoom = 4;
          map = L.map('map', {                       //was a local var but breaks the modal and getitem... should investiguate
          maxZoom: mapMaxZoom,
          minZoom: mapMinZoom,
          crs: L.CRS.Simple
        }).setView([0, 0], mapMaxZoom);
        
        var mapBounds = new L.LatLngBounds(
            map.unproject([0, 3072], mapMaxZoom),
            map.unproject([2048, 0], mapMaxZoom));
            
        map.fitBounds(mapBounds);
      //  http://localhost:7999/api/tiles
      //  layer = L.tileLayer('sourcemap/{z}/{x}/{y}.png',
        layer = L.tileLayer('http://localhost:7999/api/tiles/{z}/{x}/{y}',  {
          minZoom: mapMinZoom, maxZoom: mapMaxZoom,
          bounds: mapBounds,
          attribution: 'Rendered with <a href="https://www.maptiler.com/">MapTiler</a>',
          noWrap: true,
          tms: false
        }).addTo(map);


      

// begin the fiddling 

createMenu(map);


// test easybutton


var stateChangingButton = L.easyButton({
    states: [{
            stateName: 'unlogged',        // name the state
            icon:      'fa-sign-in',               // and define its properties
            title:     'Log in',      // like its title
            onClick: function(btn, map) {       // and its callback
              adminMode = true;
              alert("Admin mode : " + adminMode); 
              //TODO: login form
              btn.state('logged');    // change state on click!
              document.getElementById('loginForm').style.display='block'; //summon the login modal
              refreshUI(map);
            }
        }, {
            stateName: 'logged',
            icon:      'fa-sign-out',
            title:     'Log out',
            onClick: function(btn, map) {
                adminMode = false;
                alert("Admin mode : " + adminMode);
                
                btn.state('unlogged');
                refreshUI(map);
            }
    }]
});

stateChangingButton.addTo( map );



// define toolbar options


map.on('contextmenu', function(e){

  lat = e.latlng.lat;
  lng = e.latlng.lng;

  document.getElementById('itemForm').style.display='block';

});
 
map.on('click', function(e) {
    var myElement = document.getElementById("log");
    myElement.innerText = "Lon (X), Lat (Y) : " + e.latlng.lng + ", " + e.latlng.lat;
    //alert("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng)
    console.log('dafuk?');
    //fetchAPIdata();


});

//end the fiddling
}

//extract data from form

function getItem(){
 
   

    console.log('WE ADDED A MARKER' + document.getElementById('itDescr').value);


    addItem(map);
    //closes the modal
    document.getElementById('itemForm').style.display='none';

}


</script>
    <style>
      html, body, #map { width:95%; height:95%; margin:0; padding:0; z-index: 1; }
      #slider{ position: absolute; top: 10px; right: 10px; z-index: 5; }
      .leaflet-tile { border: solid black 2px; }
    </style>
  </head>
  <body onload="init()">
    <div id="map"></div>
    <!--
    <div id="log">Nothing to say...</div>
   
    
    <input id="slider" type="range" min="0" max="1" step="0.1" value="1" oninput="layer.setOpacity(this.value)">
    -->
<!-- modals  -->

<div class="w3-container">
    
       <div id="itemForm" class="w3-modal">
         <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">
     
           <div class="w3-center"><br>
             <span onclick="document.getElementById('itemForm').style.display='none'" class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
          </div>
     
           <form class="w3-container" >
             <div class="w3-section">
                <select id="itType">

                    <option value="15">Non-Player Character</option>
                    <option value="16">Player Character</option>
                    
                  </select>
               <label><b>Name</b></label>
               <input class="w3-input w3-border w3-margin-bottom" type="text" placeholder="Enter Username" name="displayname" required>
               <label><b>Description</b></label>
               <input class="w3-input w3-border" type="text" placeholder="Enter Password" name="Description" id="itDescr" required>
               <button class="w3-button w3-block w3-green w3-section w3-padding" type="button" onclick="getItem()">ADD</button>
              </div>
           </form>
     
           <div class="w3-container w3-border-top w3-padding-16 w3-light-grey">
             <button onclick="document.getElementById('itemForm').style.display='none'" type="button" class="w3-button w3-red">Cancel</button>
            </div>
     
         </div>
       </div>
     </div>



    <div class="w3-container">
   
      <div id="loginForm" class="w3-modal">
        <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">
    
          <div class="w3-center"><br>
            <span onclick="document.getElementById('loginForm').style.display='none'" class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
            <img src="img_avatar4.png" alt="Avatar" style="width:30%" class="w3-circle w3-margin-top">
          </div>
    
          <form class="w3-container" action="#">
            <div class="w3-section">
              <script>document.write("hello" + lat)</script>
              <label><b>Username</b></label>
              <input class="w3-input w3-border w3-margin-bottom" type="text" placeholder="Enter Username" name="usrname" required>
              <label><b>Password</b></label>
              <input class="w3-input w3-border" type="password" placeholder="Enter Password" name="psw" required>
              <button class="w3-button w3-block w3-green w3-section w3-padding" type="submit">Login</button>
              <input class="w3-check w3-margin-top" type="checkbox" checked="checked"> Remember me
            </div>
          </form>
    
          <div class="w3-container w3-border-top w3-padding-16 w3-light-grey">
            <button onclick="document.getElementById('loginForm').style.display='none'" type="button" class="w3-button w3-red">Cancel</button>
            <span class="w3-right w3-padding w3-hide-small">Forgot <a href="#">password?</a></span>
          </div>
    
        </div>
      </div>
    </div>

  </body>
</html>
